/**
 * üß™ PRUEBA: Generaci√≥n de Links de Pago
 */

import { PaymentLinkGenerator } from '../src/lib/payment-link-generator'
import { db } from '../src/lib/db'

async function testPaymentLinks() {
  console.log('üí≥ PRUEBA DE GENERACI√ìN DE LINKS DE PAGO\n')
  console.log('=' .repeat(70))

  // Obtener algunos productos
  const products = await db.product.findMany({
    where: { status: 'AVAILABLE' },
    take: 3
  })

  if (products.length === 0) {
    console.log('‚ùå No hay productos disponibles')
    return
  }

  console.log(`\n‚úÖ Encontrados ${products.length} productos para probar\n`)

  for (const product of products) {
    console.log('\n' + '‚îÄ'.repeat(70))
    console.log(`\nüì¶ PRODUCTO: ${product.name}`)
    console.log(`üí∞ Precio: ${product.price.toLocaleString('es-CO')} COP`)
    console.log(`üìÅ Categor√≠a: ${product.category}`)
    
    console.log('\nüîÑ Generando links de pago...')

    try {
      const paymentLinks = await PaymentLinkGenerator.generatePaymentLinks(product.id)

      if (!paymentLinks) {
        console.log('‚ùå No se pudieron generar los links')
        continue
      }

      console.log('\n‚úÖ LINKS GENERADOS:')
      console.log('\n1Ô∏è‚É£ Nequi/Daviplata:')
      console.log(`   üì± ${paymentLinks.methods.nequi}`)

      if (paymentLinks.methods.mercadopago) {
        console.log('\n2Ô∏è‚É£ MercadoPago:')
        console.log(`   üí≥ ${paymentLinks.methods.mercadopago}`)
      } else {
        console.log('\n2Ô∏è‚É£ MercadoPago:')
        console.log(`   ‚ö†Ô∏è  No configurado (falta MERCADOPAGO_ACCESS_TOKEN en .env)`)
      }

      if (paymentLinks.methods.paypal) {
        console.log('\n3Ô∏è‚É£ PayPal:')
        console.log(`   üåé ${paymentLinks.methods.paypal}`)
      } else {
        console.log('\n3Ô∏è‚É£ PayPal:')
        console.log(`   ‚ö†Ô∏è  No configurado (falta PAYPAL_CLIENT_ID en .env)`)
      }

      console.log('\n4Ô∏è‚É£ Transferencia:')
      console.log(`   üè¶ ${paymentLinks.methods.transferencia?.banco}`)
      console.log(`   üìã ${paymentLinks.methods.transferencia?.cuenta}`)

      console.log('\nüìù INSTRUCCIONES PARA WHATSAPP:')
      console.log('‚îÄ'.repeat(70))
      console.log(paymentLinks.instructions)
      console.log('‚îÄ'.repeat(70))

      // Probar respuesta seg√∫n m√©todo
      console.log('\nüß™ PROBANDO RESPUESTAS POR M√âTODO:')
      
      const methods = ['nequi', 'tarjeta', 'paypal', 'transferencia']
      for (const method of methods) {
        console.log(`\nüì± Cliente elige: "${method}"`)
        const response = PaymentLinkGenerator.generateMethodResponse(method, paymentLinks)
        console.log('‚îÄ'.repeat(70))
        console.log(response)
        console.log('‚îÄ'.repeat(70))
      }

    } catch (error) {
      console.error('‚ùå Error:', error)
    }
  }

  console.log('\n\n' + '='.repeat(70))
  console.log('\n‚úÖ PRUEBAS COMPLETADAS')
  console.log('\nüí° NOTAS:')
  console.log('   - Si MercadoPago/PayPal no est√°n configurados, solo ver√°s Nequi y Transferencia')
  console.log('   - Configura las credenciales en .env para habilitar todos los m√©todos')
  console.log('   - Los links de MercadoPago/PayPal son din√°micos y se generan en tiempo real')
  console.log('\n' + '='.repeat(70))
}

// Ejecutar
testPaymentLinks()
  .then(() => {
    console.log('\n‚úÖ Script finalizado')
    process.exit(0)
  })
  .catch((error) => {
    console.error('\n‚ùå Error:', error)
    process.exit(1)
  })
