const fs = require('fs');
const path = require('path');

const filePath = path.join(__dirname, '../src/lib/sales-agent-simple.ts');

try {
  let content = fs.readFileSync(filePath, 'utf8');

  const replacements = [
    // Emojis y sÃ­mbolos rotos
    ['Ã”ÃœÃ¡Â´Â©Ã…', 'âš ï¸'],
    ['\u00adÆ’Ã±Ã»', 'ğŸ¤–'], // Try varying sequences based on visible mess
    ['Â­Æ’Ã±Ã»', 'ğŸ¤–'],
    ['\u00adÆ’ÂºÃ¡', 'ğŸ§ '],
    ['Â­Æ’ÂºÃ¡', 'ğŸ§ '],
    ['\u00adÆ’Ã„Â»', 'ğŸ¯'],
    ['Â­Æ’Ã„Â»', 'ğŸ¯'],
    ['\u00adÆ’Ã´Âª', 'ğŸ“¦'],
    ['Â­Æ’Ã´Âª', 'ğŸ“¦'],
    ['Ã”Â£Ã ', 'âœ…'],
    ['Ã”Ã˜Ã®', 'âŒ'],
    ['\u00adÆ’Ã–Ã…', 'ğŸ™'],
    ['Â­Æ’Ã–Ã…', 'ğŸ™'],
    ['\u00adÆ’Ã¿Ã¨', 'ğŸ˜Š'],
    ['Â­Æ’Ã¿Ã¨', 'ğŸ˜Š'],
    ['\u00adÆ’Ã…Â¬', 'ğŸª'],
    ['Â­Æ’Ã…Â¬', 'ğŸª'],
    ['\u00adÆ’Ã…Ã³', 'ğŸ¢'],
    ['Â­Æ’Ã…Ã³', 'ğŸ¢'],
    ['\u00adÆ’Ã¶Ã¬', 'ğŸ”'],
    ['Â­Æ’Ã¶Ã¬', 'ğŸ”'],
    ['\u00adÆ’Ã¶Ã‘', 'ğŸ”¥'],
    ['Â­Æ’Ã¶Ã‘', 'ğŸ”¥'],
    ['\u00adÆ’Ã¶Âº', 'ğŸ”§'],
    ['Â­Æ’Ã¶Âº', 'ğŸ”§'],
    ['\u00adÆ’Ã¶Â©', 'ğŸ“¸'],
    ['Â­Æ’Ã¶Â©', 'ğŸ“¸'],
    ['\u00adÆ’Ã¶Ã©', 'ğŸ“‚'],
    ['Â­Æ’Ã¶Ã©', 'ğŸ“‚'],
    ['\u00adÆ’Ã¶Ã¯', 'ğŸ“‹'],
    ['Â­Æ’Ã¶Ã¯', 'ğŸ“‹'],
    ['\u00adÆ’Ã¶Ã¦', 'ğŸ”‘'],
    ['Â­Æ’Ã¶Ã¦', 'ğŸ”‘'],
    ['\u00adÆ’Ã¶â•£', 'ğŸ”¹'],
    ['Â­Æ’Ã¶â•£', 'ğŸ”¹'],
    ['Ã”Ã»Â½Â´Â©Ã…', 'â–«ï¸'],
    ['Ã”Ã»Â©', 'â–¸'],
    ['Ã”Â¼Ã‰', 'â­'],
    ['\u00adÆ’Ã´Ã—', 'ğŸ“'],
    ['Â­Æ’Ã´Ã—', 'ğŸ“'],
    ['\u00adÆ’Ã´Ã¬', 'ğŸ“'],
    ['Â­Æ’Ã´Ã¬', 'ğŸ“'],
    ['\u00adÆ’Ã´â–’', 'ğŸ“±'],
    ['Â­Æ’Ã´â–’', 'ğŸ“±'],
    ['\u00adÆ’Ã´Ã½', 'ğŸ“'],
    ['\u00adÆ’Ã´Ã˜', 'ğŸ“'],
    ['Â­Æ’Ã´Ã½', 'ğŸ“'],
    ['Â­Æ’Ã´Ã˜', 'ğŸ“'],
    ['\u00adÆ’Ã´Ã¯', 'ğŸ“‹'],
    ['Â­Æ’Ã´Ã¯', 'ğŸ“‹'],
    ['\u00adÆ’Ã´Â©', 'ğŸ“¸'],
    ['Â­Æ’Ã´Â©', 'ğŸ“¸'],
    ['\u00adÆ’ÃœÃœ', 'ğŸšš'],
    ['Â­Æ’ÃœÃœ', 'ğŸšš'],
    ['\u00adÆ’ÃœÃ¸', 'ğŸš›'],
    ['Â­Æ’ÃœÃ¸', 'ğŸš›'],
    ['\u00adÆ’ÃœÃ‡', 'ğŸš€'],
    ['Â­Æ’ÃœÃ‡', 'ğŸš€'],
    ['\u00adÆ’Ã„Ã«', 'ğŸ‰'],
    ['Â­Æ’Ã„Ã«', 'ğŸ‰'],
    ['\u00adÆ’Ã„Ã¼', 'ğŸ'],
    ['Â­Æ’Ã„Ã¼', 'ğŸ'],
    ['\u00adÆ’Ã†â–‘', 'ğŸ’°'],
    ['Â­Æ’Ã†â–‘', 'ğŸ’°'],
    ['\u00adÆ’Ã†Ã„', 'ğŸ’'],
    ['Â­Æ’Ã†Ã„', 'ğŸ’'],
    ['\u00adÆ’Ã†Â¬', 'ğŸ’ª'],
    ['Â­Æ’Ã†Â¬', 'ğŸ’ª'],
    ['\u00adÆ’Ã†â•', 'ğŸ’¼'],
    ['Â­Æ’Ã†â•', 'ğŸ’¼'],
    ['\u00adÆ’Ã†Â¼', 'ğŸ’¬'],
    ['Â­Æ’Ã†Â¼', 'ğŸ’¬'],
    ['\u00adÆ’Ã†â–“', 'ğŸ”„'],
    ['\u00adÆ’Ã¶Ã¤', 'ğŸ”„'],
    ['Â­Æ’Ã†â–“', 'ğŸ”„'],
    ['Â­Æ’Ã¶Ã¤', 'ğŸ”„'],
    ['\u00adÆ’Ã¸Ã­Â´Â©Ã…', 'ğŸ›¡ï¸'],
    ['Â­Æ’Ã¸Ã­Â´Â©Ã…', 'ğŸ›¡ï¸'],
    ['\u00adÆ’Ã¶Ã†', 'ğŸ”’'],
    ['Â­Æ’Ã¶Ã†', 'ğŸ”’'],
    ['\u00adÆ’Æ’Ã³', 'ğŸŸ¢'],
    ['Â­Æ’Æ’Ã³', 'ğŸŸ¢'],
    ['\u00adÆ’Æ’Ã­', 'ğŸŸ¡'],
    ['Â­Æ’Æ’Ã­', 'ğŸŸ¡'],
    ['\u00adÆ’Ã¶Ã', 'ğŸ”µ'],
    ['Â­Æ’Ã¶Ã', 'ğŸ”µ'],
    ['Ã”Â£Â¿', 'âœ¨'],
    ['\u00adÆ’Ã®Æ’', 'ğŸŒŸ'],
    ['Â­Æ’Ã®Æ’', 'ğŸŒŸ'],
    ['\u00adÆ’Ã±Â®', 'ğŸ¤©'],
    ['Â­Æ’Ã±Â®', 'ğŸ¤©'],
    ['\u00adÆ’Ã±Ã˜', 'ğŸ¤'], // or similar
    ['Â­Æ’Ã±Ã˜', 'ğŸ¤'],
    ['\u00adÆ’Ã±Â©', 'ğŸ¤”'],
    ['Â­Æ’Ã±Â©', 'ğŸ¤”'],
    ['Ã”Ã…â–‘', 'â°'],
    ['Ã”Ã–Â¥Â´Â©Ã…', 'â™¾ï¸'],
    ['Ã”ÃœÃ­', 'âš¡'],
    ['\u00adÆ’Ã´Ã‘', 'ğŸ“¥'],
    ['Â­Æ’Ã´Ã‘', 'ğŸ“¥'],
    ['\u00adÆ’Ã†â•—', 'ğŸ’»'],
    ['Â­Æ’Ã†â•—', 'ğŸ’»'],
    ['\u00adÆ’Ã¦Ã¯', 'ğŸ‘‹'],
    ['Â­Æ’Ã¦Ã¯', 'ğŸ‘‹'],
    ['\u00adÆ’Ã¦Ã¬', 'ğŸ‘'],
    ['Â­Æ’Ã¦Ã¬', 'ğŸ‘'],
    ['1Â´Â©Ã…Ã”Ã¢Ãº', '1ï¸âƒ£'],
    ['2Â´Â©Ã…Ã”Ã¢Ãº', '2ï¸âƒ£'],
    ['3Â´Â©Ã…Ã”Ã¢Ãº', '3ï¸âƒ£'],

    // Caracteres latinos rotos
    ['â”œÃ­', 'Ã¡'],
    ['â”œÂ®', 'Ã©'],
    ['â”œÂ¡', 'Ã­'],
    ['â”œâ”‚', 'Ã³'],
    ['â”œâ•‘', 'Ãº'],
    ['â”œâ–’', 'Ã±'],
    ['â”œÃ¼', 'Ã'],
    ['â”œÃ«', 'Ã‰'],
    ['â”œÃ¬', 'Ã'],
    ['â”œÃ´', 'Ã“'],
    ['â”œÃœ', 'Ãš'],
    ['â”œÃ¦', 'Ã‘'],
    
    // Signos
    ['â”¬Ã­', 'Â¡'],
    ['â”¬â”', 'Â¿'],
    
    // Cajas de texto (ASCII art corrumpido)
    ['Ã”Ã²Ã‰', 'â•'],
    ['Ã”Ã²Ã¶', 'â•”'],
    ['Ã”Ã²Ã¹', 'â•—'],
    ['Ã”Ã²Ãœ', 'â•š'],
    ['Ã”Ã²Ã˜', 'â•'],
    ['Ã”Ã¶Ã¼', 'â”'],
    
    // Unicode escapes visibles
    ['u00a1', 'Â¡'],
    ['u00bf', 'Â¿'],
    ['u00e1', 'Ã¡'],
    ['u00e9', 'Ã©'],
    ['u00ed', 'Ã­'],
    ['u00f3', 'Ã³'],
    ['u00fa', 'Ãº'],
    ['u00f1', 'Ã±'],
    ['u00c1', 'Ã'],
    ['u00c9', 'Ã‰'],
    ['u00cd', 'Ã'],
    ['u00d3', 'Ã“'],
    ['u00da', 'Ãš'],
    ['u00d1', 'Ã‘'],

    // Special case for 'hibrido' in file header
    ['hâ”œÂ¡brido', 'hÃ­brido'],
  ];

  let fixedContent = content;
  for (const [bad, good] of replacements) {
    // Escape regex characters from the bad string
    const escapedBad = bad.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    fixedContent = fixedContent.replace(new RegExp(escapedBad, 'g'), good);
  }

  // Fallback for leftover mojibake patterns specifically seen
  fixedContent = fixedContent.replace(/Â­Æ’[a-zA-Z0-9]{2,}/g, ''); // Mark leftovers

  fs.writeFileSync(filePath, fixedContent, 'utf8');
  console.log('âœ… File encoding fixed successfully!');

} catch (error) {
  console.error('âŒ Error fixing file:', error);
}
