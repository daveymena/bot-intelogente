# ๐ Flujo del Sistema Hรญbrido - Diagrama Visual

## Flujo Principal

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    MENSAJE DEL USUARIO                          โ
โ                    "Hola, cuรกnto cuesta?"                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              1. DETECTAR INTENCIรN                              โ
โ                                                                 โ
โ  โข Analizar mensaje                                            โ
โ  โข Clasificar: saludo, precio, producto, etc.                  โ
โ  โข Extraer entidades (producto, precio, ubicaciรณn)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              2. ยฟPUEDE RESPONDER LOCALMENTE?                    โ
โ                                                                 โ
โ  Verificar si es:                                              โ
โ  โ Saludo simple                                               โ
โ  โ Despedida                                                   โ
โ  โ Precio simple                                               โ
โ  โ Disponibilidad simple                                       โ
โ  โ Confirmaciรณn                                                โ
โ  โ Agradecimiento                                              โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
             โ                            โ
         Sร โ                            โ NO
             โ                            โ
             โผ                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  RESPUESTA LOCAL         โ   โ  3. BUSCAR EN BASE DE DATOS      โ
โ  (Sin IA - Instantรกnea)  โ   โ                                  โ
โ                          โ   โ  โข Buscar productos              โ
โ  โก < 10ms               โ   โ  โข Obtener contexto              โ
โ  ๐ฐ 0 tokens             โ   โ  โข Cargar historial              โ
โ  โ Siempre disponible   โ   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ                โ
             โ                              โผ
             โ                   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ                   โ  4. SELECCIONAR FLUJO            โ
             โ                   โ                                  โ
             โ                   โ  Segรบn tipo de producto:         โ
             โ                   โ  โข Fรญsico โ flujoFisico.ts       โ
             โ                   โ  โข Digital โ flujoDigital.ts     โ
             โ                   โ  โข Dropship โ flujoDropship.ts   โ
             โ                   โ  โข Servicio โ flujoServicio.ts   โ
             โ                   โ  โข General โ flujoGeneral.ts     โ
             โ                   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
             โ                                โ
             โ                                โผ
             โ                   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ                   โ  5. CONSTRUIR PROMPT             โ
             โ                   โ                                  โ
             โ                   โ  โข Prompt del sistema            โ
             โ                   โ  โข Prompt especรญfico del flujo   โ
             โ                   โ  โข Historial de conversaciรณn     โ
             โ                   โ  โข Datos del producto            โ
             โ                   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
             โ                                โ
             โ                                โผ
             โ                   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ                   โ  6. LLAMAR IA                    โ
             โ                   โ                                  โ
             โ                   โ  Groq (primario)                 โ
             โ                   โ    โ (si falla)                  โ
             โ                   โ  Ollama (fallback)               โ
             โ                   โ    โ (si falla)                  โ
             โ                   โ  Respuesta estรกtica              โ
             โ                   โ                                  โ
             โ                   โ  ๐ค 500-2000ms                   โ
             โ                   โ  ๐ฐ ~500 tokens                  โ
             โ                   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
             โ                                โ
             โ                                โผ
             โ                   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ                   โ  7. VALIDAR RESPUESTA            โ
             โ                   โ                                  โ
             โ                   โ  โข Verificar precios correctos   โ
             โ                   โ  โข Validar disponibilidad        โ
             โ                   โ  โข Evitar informaciรณn inventada  โ
             โ                   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
             โ                                โ
             โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              8. GUARDAR EN BASE DE DATOS                        โ
โ                                                                 โ
โ  โข Guardar mensaje del usuario                                 โ
โ  โข Guardar respuesta del bot                                   โ
โ  โข Actualizar contexto                                         โ
โ  โข Registrar estadรญsticas                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              9. ENVIAR RESPUESTA AL USUARIO                     โ
โ                                                                 โ
โ  "ยกHola! ๐ Bienvenido a Tecnovariedades D&S                   โ
โ   El producto cuesta $1.500.000 COP                            โ
โ   ยฟTe gustarรญa mรกs informaciรณn? ๐"                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Ejemplo: Saludo Simple

```
Usuario: "Hola"
   โ
Detectar intenciรณn: SALUDO
   โ
ยฟLocal? โ Sร โ
   โ
Respuesta local: "ยกHola! ๐ Bienvenido..."
   โ
โก 8ms | ๐ฐ 0 tokens | โ Local
```

## Ejemplo: Consulta Compleja

```
Usuario: "Necesito un computador para diseรฑo grรกfico con presupuesto de 2 millones"
   โ
Detectar intenciรณn: BUSQUEDA_PRODUCTO
   โ
ยฟLocal? โ NO โ (muy complejo)
   โ
Buscar productos en BD
   โ
Construir prompt especializado
   โ
Llamar Groq IA ๐ค
   โ
Validar respuesta
   โ
Guardar en BD
   โ
โก 1200ms | ๐ฐ 650 tokens | ๐ค IA
```

## Estadรญsticas en Tiempo Real

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     ESTADรSTICAS DE AHORRO          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  Respuestas locales:  45 (75%)      โ
โ  Respuestas con IA:   15 (25%)      โ
โ  Total mensajes:      60            โ
โ                                     โ
โ  ๐ฐ Tokens ahorrados: 22,500        โ
โ  ๐ต Costo evitado:    $0.0023 USD   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Decisiรณn: ยฟLocal o IA?

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CRITERIOS DE DECISIรN                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  RESPUESTA LOCAL (sin IA) cuando:                          โ
โ  โ Saludo de 1-3 palabras                                  โ
โ  โ Despedida simple                                        โ
โ  โ Pregunta de precio exacta: "cuรกnto cuesta"             โ
โ  โ Pregunta de disponibilidad exacta: "tienen"            โ
โ  โ Confirmaciรณn: "sรญ", "ok", "vale"                       โ
โ  โ Agradecimiento: "gracias"                              โ
โ  โ Mensaje muy corto (< 3 caracteres)                     โ
โ                                                             โ
โ  RESPUESTA CON IA cuando:                                   โ
โ  โ Pregunta con contexto                                   โ
โ  โ Comparaciรณn de productos                                โ
โ  โ Recomendaciรณn personalizada                             โ
โ  โ Negociaciรณn                                             โ
โ  โ Objeciรณn de venta                                       โ
โ  โ Consulta compleja                                       โ
โ  โ Requiere razonamiento                                   โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Flujo de Fallback

```
โโโโโโโโโโโโโโโโ
โ  Llamar IA   โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโ
โ  Groq API        โ  โ Intento 1 (primario)
โ  (Llama 3.1)     โ
โโโโโโโโฌโโโโโโโโโโโโ
       โ
       โ โ Error
       โผ
โโโโโโโโโโโโโโโโโโโโ
โ  Ollama Local    โ  โ Intento 2 (fallback)
โ  (Llama 3.1)     โ
โโโโโโโโฌโโโโโโโโโโโโ
       โ
       โ โ Error
       โผ
โโโโโโโโโโโโโโโโโโโโ
โ  Respuesta       โ  โ Intento 3 (รบltimo recurso)
โ  Estรกtica        โ
โโโโโโโโโโโโโโโโโโโโ
```

## Ventajas del Sistema Hรญbrido

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    COMPARACIรN                              โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโค
โ   Caracterรญstica โ   Solo IA        โ   Sistema Hรญbrido    โ
โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโค
โ   Velocidad      โ   500-2000ms     โ   10-2000ms          โ
โ   Tokens/mensaje โ   ~500           โ   ~100-200 promedio  โ
โ   Costo/1000 msg โ   $0.05          โ   $0.01-0.02         โ
โ   Disponibilidad โ   Depende de API โ   Siempre disponible โ
โ   Consistencia   โ   Variable       โ   Alta en casos      โ
โ                  โ                  โ   simples            โ
โโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโ
```

## Resumen Visual

```
๐ฏ OBJETIVO: Responder rรกpido y econรณmico

๐ RESULTADO:
   โข 75% respuestas locales (instantรกneas)
   โข 25% respuestas con IA (complejas)
   โข 60-80% ahorro en tokens
   โข 70% mรกs rรกpido en promedio

โ BENEFICIOS:
   โก Velocidad
   ๐ฐ Ahorro
   ๐ Confiabilidad
   ๐ Escalabilidad
```
