ğŸ”§ COMANDOS DE DIAGNÃ“STICO - CONEXIÃ“N WHATSAPP
==============================================

ğŸ“Š VERIFICAR ESTADO ACTUAL
---------------------------
npx tsx scripts/test-estabilizacion-conexion.ts

Muestra:
- Estado de la sesiÃ³n (CONNECTED, DISCONNECTED, etc.)
- Si estÃ¡ lista para enviar (isReady)
- Tiempo desde Ãºltima conexiÃ³n
- Mensajes en cola (pendientes, enviados, fallidos)


ğŸ” MONITOREAR EN TIEMPO REAL
-----------------------------
npx tsx scripts/monitorear-estabilidad-conexion.ts

Actualiza cada 500ms:
- ğŸŸ¢ Estado de conexiÃ³n
- âœ… Si estÃ¡ lista
- â±ï¸  Tiempo desde conexiÃ³n
- â³ Tiempo restante para estabilizar
- ğŸ“¬ Mensajes en cola

Presiona Ctrl+C para detener


ğŸ§ª SIMULAR RECONEXIÃ“N RÃPIDA
-----------------------------
npx tsx scripts/simular-reconexion-rapida.ts

Simula el escenario que causaba "Connection Closed":
- Verifica estado de conexiÃ³n
- Intenta enviar mensaje inmediatamente
- Muestra si el sistema espera correctamente
- Verifica cola de mensajes


ğŸ”„ RESETEAR WHATSAPP COMPLETAMENTE
-----------------------------------
npx tsx scripts/reset-completo-baileys.ts

Limpia TODO:
- Cierra conexiÃ³n actual
- Elimina archivos de sesiÃ³n
- Limpia base de datos
- Permite empezar desde cero


ğŸ“‹ VERIFICAR CONFIGURACIÃ“N
---------------------------
npx tsx scripts/verificar-config-ia.ts

Verifica:
- Variables de entorno
- ConfiguraciÃ³n de IA
- Credenciales de Groq
- Estado de servicios


ğŸ¯ DIAGNOSTICAR PROBLEMAS
--------------------------
npx tsx scripts/diagnosticar-bot-completo.ts

DiagnÃ³stico completo:
- Estado de WhatsApp
- ConfiguraciÃ³n de IA
- Productos en base de datos
- Conversaciones activas
- Mensajes recientes


ğŸ“Š VER ESTADÃSTICAS DE COLA
----------------------------
# Incluido en test-estabilizacion-conexion.ts
npx tsx scripts/test-estabilizacion-conexion.ts


ğŸ”§ COMANDOS ÃšTILES DEL SERVIDOR
--------------------------------
# Iniciar servidor en desarrollo
npm run dev

# Ver logs en tiempo real
# (Los logs se muestran automÃ¡ticamente en la consola)

# Reiniciar servidor
# Presiona Ctrl+C y luego npm run dev


ğŸ“ LOGS IMPORTANTES A OBSERVAR
-------------------------------

âœ… CONEXIÃ“N EXITOSA:
[WhatsApp Web] âœ… ConexiÃ³n establecida
[WhatsApp Web] â³ Esperando 3000ms para estabilizar...
[WhatsApp Web] âœ… ConexiÃ³n estabilizada y lista

âœ… ENVÃO EXITOSO:
[WhatsApp Web] ğŸ“¤ Enviando respuesta...
[WhatsApp Web] âœ… Respuesta enviada exitosamente

â³ ESPERANDO ESTABILIZACIÃ“N:
[WhatsApp Web] â³ Esperando XXXms para que la conexiÃ³n se estabilice...

ğŸ“¬ MENSAJE ENCOLADO:
[WhatsApp Web] ğŸ“¬ WhatsApp desconectado, agregando mensaje a la cola

âŒ ERROR (ya no deberÃ­a pasar):
[WhatsApp Web] âŒ Error: Connection Closed


ğŸ¯ FLUJO DE DIAGNÃ“STICO RECOMENDADO
------------------------------------

1. Verificar estado actual:
   npx tsx scripts/test-estabilizacion-conexion.ts

2. Si hay problemas, monitorear en tiempo real:
   npx tsx scripts/monitorear-estabilidad-conexion.ts

3. Probar reconexiÃ³n:
   - Desconecta WhatsApp Web en tu telÃ©fono
   - Observa el monitor
   - Reconecta WhatsApp Web
   - Verifica que se estabiliza correctamente

4. Si persisten problemas, resetear:
   npx tsx scripts/reset-completo-baileys.ts

5. Verificar configuraciÃ³n:
   npx tsx scripts/verificar-config-ia.ts


âš™ï¸ AJUSTAR TIEMPO DE ESTABILIZACIÃ“N
------------------------------------

Si necesitas cambiar el tiempo de espera (actualmente 3 segundos):

Editar: src/lib/whatsapp-web-service.ts
LÃ­nea: private static readonly CONNECTION_STABLE_DELAY = 3000

Valores recomendados:
- Desarrollo local: 2000 (2 segundos)
- ProducciÃ³n estable: 3000 (3 segundos)
- ConexiÃ³n inestable: 5000 (5 segundos)


ğŸ“š DOCUMENTACIÃ“N COMPLETA
--------------------------
- SOLUCION_CONNECTION_CLOSED.md (explicaciÃ³n tÃ©cnica)
- RESUMEN_SOLUCION_RACE_CONDITION.md (resumen ejecutivo)
- ARREGLADO_CONNECTION_CLOSED.txt (resumen simple)
- PROBAR_SOLUCION_CONNECTION_CLOSED.txt (instrucciones de prueba)
